import pandas as pd
from database import db

def import_from_excel(file_path: str):
    """
    –Ü–º–ø–æ—Ä—Ç –¥–∞–Ω–∏—Ö –∑ Excel —Ñ–∞–π–ª—É
    –ö–æ–ª–æ–Ω–∫–∏:
    A - store_id (–Ω–æ–º–µ—Ä –º–∞–≥–∞–∑–∏–Ω—É)
    B - address_main (–æ—Å–Ω–æ–≤–Ω–∞ –∞–¥—Ä–µ—Å–∞) 
    C - address_additional (–¥–æ–¥–∞—Ç–∫–æ–≤–∞ –∞–¥—Ä–µ—Å–∞)
    D - schedule (–≥—Ä–∞—Ñ—ñ–∫ —Ä–æ–±–æ—Ç–∏)
    E - phone (—Ä–æ–±–æ—á–∏–π –Ω–æ–º–µ—Ä) - –û–°–ù–û–í–ù–ê –ö–û–õ–û–ù–ö–ê –î–õ–Ø –Ü–î–ï–ù–¢–ò–§–Ü–ö–ê–¶–Ü–á
    """
    try:
        # –ß–∏—Ç–∞—î–º–æ Excel —Ñ–∞–π–ª—É
        df = pd.read_excel(file_path)
        
        print(f"–ó–Ω–∞–π–¥–µ–Ω–æ –∫–æ–ª–æ–Ω–∫–∏: {df.columns.tolist()}")
        print(f"–ö—ñ–ª—å–∫—ñ—Å—Ç—å —Ä—è–¥–∫—ñ–≤: {len(df)}")
        
        imported_count = 0
        error_count = 0
        
        # –Ü–º–ø–æ—Ä—Ç—É—î–º–æ –¥–∞–Ω—ñ
        for index, row in df.iterrows():
            try:
                store_id = str(row.iloc[0]).strip() if pd.notna(row.iloc[0]) else ""  # –ö–æ–ª–æ–Ω–∫–∞ A
                address_main = str(row.iloc[1]).strip() if pd.notna(row.iloc[1]) else ""  # –ö–æ–ª–æ–Ω–∫–∞ B
                address_additional = str(row.iloc[2]).strip() if len(row) > 2 and pd.notna(row.iloc[2]) else ""  # –ö–æ–ª–æ–Ω–∫–∞ C
                schedule = str(row.iloc[3]).strip() if pd.notna(row.iloc[3]) else ""  # –ö–æ–ª–æ–Ω–∫–∞ D
                phone = str(row.iloc[4]).strip() if len(row) > 4 and pd.notna(row.iloc[4]) else ""  # –ö–æ–ª–æ–Ω–∫–∞ E
                
                # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –æ–±–æ–≤'—è–∑–∫–æ–≤—ñ –ø–æ–ª—è
                if store_id and store_id != 'nan' and phone and phone != 'nan':
                    db.add_store(store_id, phone, address_main, address_additional, schedule)
                    print(f"‚úÖ –î–æ–¥–∞–Ω–æ –º–∞–≥–∞–∑–∏–Ω: {store_id} - {phone} - {address_main}")
                    imported_count += 1
                else:
                    print(f"‚ùå –ü—Ä–æ–ø—É—â–µ–Ω–æ —Ä—è–¥–æ–∫ {index+1}: –≤—ñ–¥—Å—É—Ç–Ω—ñ–π store_id –∞–±–æ phone")
                    error_count += 1
                    
            except Exception as e:
                print(f"‚ùå –ü–æ–º–∏–ª–∫–∞ –≤ —Ä—è–¥–∫—É {index+1}: {e}")
                error_count += 1
        
        print(f"\nüìä –ü—ñ–¥—Å—É–º–æ–∫ —ñ–º–ø–æ—Ä—Ç—É:")
        print(f"‚úÖ –£—Å–ø—ñ—à–Ω–æ —ñ–º–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ: {imported_count}")
        print(f"‚ùå –ü–æ–º–∏–ª–æ–∫: {error_count}")
        print(f"üìã –ó–∞–≥–∞–ª–æ–º —Ä—è–¥–∫—ñ–≤: {len(df)}")
        
    except Exception as e:
        print(f"‚ùå –ü–æ–º–∏–ª–∫–∞ —ñ–º–ø–æ—Ä—Ç—É: {e}")

if name == "__main__":
    # –ó–∞–ø—É—Å—Ç—ñ—Ç—å —Ü–µ–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è —ñ–º–ø–æ—Ä—Ç—É –¥–∞–Ω–∏—Ö
    import_from_excel("stores_data.xlsx")